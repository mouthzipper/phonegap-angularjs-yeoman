!function(){"use strict";function a(a,b){a.when("/",{controller:"HomeController",templateUrl:"views/home/home.view.html",controllerAs:"vm"}).when("/login",{controller:"LoginController",templateUrl:"views/login/login.view.html",controllerAs:"vm"}).when("/register",{controller:"RegisterController",templateUrl:"views/register/register.view.html",controllerAs:"vm"}).otherwise({redirectTo:"/login"})}function b(a,b,c,d){a.globals=c.get("globals")||{},a.globals.currentUser&&(d.defaults.headers.common.Authorization="Basic "+a.globals.currentUser.authdata),a.$on("$locationChangeStart",function(c,d,e){var f=-1===$.inArray(b.path(),["/login","/register"]),g=a.globals.currentUser;f&&!g&&b.path("/login")})}angular.module("x1App",["ngRoute","ngCookies"]).config(a).run(b),a.$inject=["$routeProvider","$locationProvider"],b.$inject=["$rootScope","$location","$cookieStore","$http"]}(),function(){"use strict";function a(a,c,d,e,f){function g(a,b,c){e(function(){var d;f.GetByUsername(a).then(function(a){d=null!==a&&a.password===b?{success:!0}:{success:!1,message:"Username or password is incorrect"},c(d)})},1e3)}function h(e,f){var g=b.encode(e+":"+f);d.globals={currentUser:{username:e,authdata:g}},a.defaults.headers.common.Authorization="Basic "+g,c.put("globals",d.globals)}function i(){d.globals={},c.remove("globals"),a.defaults.headers.common.Authorization="Basic "}var j={};return j.Login=g,j.SetCredentials=h,j.ClearCredentials=i,j}angular.module("x1App").factory("AuthenticationService",a),a.$inject=["$http","$cookieStore","$rootScope","$timeout","UserService"];var b={keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(a){var b,c,d,e,f,g="",h="",i="",j=0;do b=a.charCodeAt(j++),c=a.charCodeAt(j++),h=a.charCodeAt(j++),d=b>>2,e=(3&b)<<4|c>>4,f=(15&c)<<2|h>>6,i=63&h,isNaN(c)?f=i=64:isNaN(h)&&(i=64),g=g+this.keyStr.charAt(d)+this.keyStr.charAt(e)+this.keyStr.charAt(f)+this.keyStr.charAt(i),b=c=h="",d=e=f=i="";while(j<a.length);return g},decode:function(a){var b,c,d,e,f,g="",h="",i="",j=0,k=/[^A-Za-z0-9\+\/\=]/g;k.exec(a)&&window.alert("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\nExpect errors in decoding."),a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");do d=this.keyStr.indexOf(a.charAt(j++)),e=this.keyStr.indexOf(a.charAt(j++)),f=this.keyStr.indexOf(a.charAt(j++)),i=this.keyStr.indexOf(a.charAt(j++)),b=d<<2|e>>4,c=(15&e)<<4|f>>2,h=(3&f)<<6|i,g+=String.fromCharCode(b),64!=f&&(g+=String.fromCharCode(c)),64!=i&&(g+=String.fromCharCode(h)),b=c=h="",d=e=f=i="";while(j<a.length);return g}}}(),function(){"use strict";function a(a){function b(){function b(){var b=a.flash;b&&(b.keepAfterLocationChange?b.keepAfterLocationChange=!1:delete a.flash)}a.$on("$locationChangeStart",function(){b()})}function c(b,c){a.flash={message:b,type:"success",keepAfterLocationChange:c}}function d(b,c){a.flash={message:b,type:"error",keepAfterLocationChange:c}}var e={};return e.Success=c,e.Error=d,b(),e}angular.module("x1App").factory("FlashService",a),a.$inject=["$rootScope"]}(),function(){"use strict";function a(a,b,c){function d(){var a=c.defer();return a.resolve(j()),a.promise}function e(a){var d=c.defer(),e=b("filter")(j(),{id:a}),f=e.length?e[0]:null;return d.resolve(f),d.promise}function f(a){var d=c.defer(),e=b("filter")(j(),{username:a}),f=e.length?e[0]:null;return d.resolve(f),d.promise}function g(b){var d=c.defer();return a(function(){f(b.username).then(function(a){if(null!==a)d.resolve({success:!1,message:'Username "'+b.username+'" is already taken'});else{var c=j(),e=c[c.length-1]||{id:0};b.id=e.id+1,c.push(b),k(c),d.resolve({success:!0})}})},1e3),d.promise}function h(a){for(var b=c.defer(),d=j(),e=0;e<d.length;e++)if(d[e].id===a.id){d[e]=a;break}return k(d),b.resolve(),b.promise}function i(a){for(var b=c.defer(),d=j(),e=0;e<d.length;e++){var f=d[e];if(f.id===a){d.splice(e,1);break}}return k(d),b.resolve(),b.promise}function j(){return localStorage.users||(localStorage.users=JSON.stringify([])),JSON.parse(localStorage.users)}function k(a){localStorage.users=JSON.stringify(a)}var l={};return l.GetAll=d,l.GetById=e,l.GetByUsername=f,l.Create=g,l.Update=h,l.Delete=i,l}angular.module("x1App").factory("UserService",a),a.$inject=["$timeout","$filter","$q"]}(),function(){"use strict";function a(a,b){function c(){d(),e()}function d(){a.GetByUsername(b.globals.currentUser.username).then(function(a){g.user=a})}function e(){a.GetAll().then(function(a){g.allUsers=a})}function f(b){a.Delete(b).then(function(){e()})}var g=this;g.user=null,g.allUsers=[],g.deleteUser=f,c()}angular.module("x1App").controller("HomeController",a),a.$inject=["UserService","$rootScope"]}(),function(){"use strict";function a(a,b,c){function d(){e.dataLoading=!0,b.Login(e.username,e.password,function(d){d.success?(b.SetCredentials(e.username,e.password),a.path("/")):(c.Error(d.message),e.dataLoading=!1)})}var e=this;e.login=d,function(){b.ClearCredentials()}()}angular.module("x1App").controller("LoginController",a),a.$inject=["$location","AuthenticationService","FlashService"]}(),function(){"use strict";function a(a,b,c,d){function e(){f.dataLoading=!0,a.Create(f.user).then(function(a){console.log(a),a.success?(d.Success("Registration successful",!0),b.path("/login")):(d.Error(a.message),f.dataLoading=!1)})}var f=this;f.register=e}angular.module("x1App").controller("RegisterController",a),a.$inject=["UserService","$location","$rootScope","FlashService"]}(),angular.module("x1App").run(["$templateCache",function(a){"use strict";a.put("views/home/home.view.html",'<h1>Hi {{vm.user.firstName}}!</h1> <p>You\'re logged in!!</p> <h3>All registered users:</h3> <ul> <li ng-repeat="user in vm.allUsers"> {{user.username}} ({{user.firstName}} {{user.lastName}}) - <a href="#" ng-click="vm.deleteUser(user.id)">Delete</a> </li> </ul> <p>&nbsp;</p> <p><a href="#/login" class="btn btn-primary">Logout</a></p>'),a.put("views/login/login.view.html",'<div class="col-md-6 col-md-offset-3"> <h2>Login</h2> <div ng-show="vm.error" class="alert alert-danger">{{vm.error}}</div> <form name="form" ng-submit="vm.login()" role="form"> <div class="form-group" ng-class="{ \'has-error\': form.username.$dirty && form.username.$error.required }"> <label for="username">Username</label> <input type="text" name="username" id="username" class="form-control" ng-model="vm.username" required> <span ng-show="form.username.$dirty && form.username.$error.required" class="help-block">Username is required</span> </div> <div class="form-group" ng-class="{ \'has-error\': form.password.$dirty && form.password.$error.required }"> <label for="password">Password</label> <input type="password" name="password" id="password" class="form-control" ng-model="vm.password" required> <span ng-show="form.password.$dirty && form.password.$error.required" class="help-block">Password is required</span> </div> <div class="form-actions"> <button type="submit" ng-disabled="form.$invalid || vm.dataLoading" class="btn btn-primary">Login</button> <img ng-if="vm.dataLoading" src="data:image/gif;base64,R0lGODlhEAAQAPIAAP///wAAAMLCwkJCQgAAAGJiYoKCgpKSkiH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAEAAQAAADMwi63P4wyklrE2MIOggZnAdOmGYJRbExwroUmcG2LmDEwnHQLVsYOd2mBzkYDAdKa+dIAAAh+QQJCgAAACwAAAAAEAAQAAADNAi63P5OjCEgG4QMu7DmikRxQlFUYDEZIGBMRVsaqHwctXXf7WEYB4Ag1xjihkMZsiUkKhIAIfkECQoAAAAsAAAAABAAEAAAAzYIujIjK8pByJDMlFYvBoVjHA70GU7xSUJhmKtwHPAKzLO9HMaoKwJZ7Rf8AYPDDzKpZBqfvwQAIfkECQoAAAAsAAAAABAAEAAAAzMIumIlK8oyhpHsnFZfhYumCYUhDAQxRIdhHBGqRoKw0R8DYlJd8z0fMDgsGo/IpHI5TAAAIfkECQoAAAAsAAAAABAAEAAAAzIIunInK0rnZBTwGPNMgQwmdsNgXGJUlIWEuR5oWUIpz8pAEAMe6TwfwyYsGo/IpFKSAAAh+QQJCgAAACwAAAAAEAAQAAADMwi6IMKQORfjdOe82p4wGccc4CEuQradylesojEMBgsUc2G7sDX3lQGBMLAJibufbSlKAAAh+QQJCgAAACwAAAAAEAAQAAADMgi63P7wCRHZnFVdmgHu2nFwlWCI3WGc3TSWhUFGxTAUkGCbtgENBMJAEJsxgMLWzpEAACH5BAkKAAAALAAAAAAQABAAAAMyCLrc/jDKSatlQtScKdceCAjDII7HcQ4EMTCpyrCuUBjCYRgHVtqlAiB1YhiCnlsRkAAAOwAAAAAAAAAAAA=="> <a href="#/register" class="btn btn-link">Register</a> </div> </form> </div>'),a.put("views/main.html",'<div class="jumbotron"> <div class="container"> <div class="col-sm-8 col-sm-offset-2"> <div ng-class="{ \'alert\': flash, \'alert-success\': flash.type === \'success\', \'alert-danger\': flash.type === \'error\' }" ng-if="flash" ng-bind="flash.message"></div> <div ng-view></div> </div> </div> </div>'),a.put("views/register/register.view.html",'<div class="col-md-6 col-md-offset-3"> <h2>Register</h2> <div ng-show="vm.error" class="alert alert-danger">{{vm.error}}</div> <form name="form" ng-submit="vm.register()" role="form"> <div class="form-group" ng-class="{ \'has-error\': form.firstName.$dirty && form.firstName.$error.required }"> <label for="username">First name</label> <input type="text" name="firstName" id="firstName" class="form-control" ng-model="vm.user.firstName" required> <span ng-show="form.firstName.$dirty && form.firstName.$error.required" class="help-block">First name is required</span> </div> <div class="form-group" ng-class="{ \'has-error\': form.lastName.$dirty && form.lastName.$error.required }"> <label for="username">Last name</label> <input type="text" name="lastName" id="Text1" class="form-control" ng-model="vm.user.lastName" required> <span ng-show="form.lastName.$dirty && form.lastName.$error.required" class="help-block">Last name is required</span> </div> <div class="form-group" ng-class="{ \'has-error\': form.username.$dirty && form.username.$error.required }"> <label for="username">Username</label> <input type="text" name="username" id="username" class="form-control" ng-model="vm.user.username" required> <span ng-show="form.username.$dirty && form.username.$error.required" class="help-block">Username is required</span> </div> <div class="form-group" ng-class="{ \'has-error\': form.password.$dirty && form.password.$error.required }"> <label for="password">Password</label> <input type="password" name="password" id="password" class="form-control" ng-model="vm.user.password" required> <span ng-show="form.password.$dirty && form.password.$error.required" class="help-block">Password is required</span> </div> <div class="form-actions"> <button type="submit" ng-disabled="form.$invalid || vm.dataLoading" class="btn btn-primary">Register</button> <img ng-if="vm.dataLoading" src="data:image/gif;base64,R0lGODlhEAAQAPIAAP///wAAAMLCwkJCQgAAAGJiYoKCgpKSkiH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAEAAQAAADMwi63P4wyklrE2MIOggZnAdOmGYJRbExwroUmcG2LmDEwnHQLVsYOd2mBzkYDAdKa+dIAAAh+QQJCgAAACwAAAAAEAAQAAADNAi63P5OjCEgG4QMu7DmikRxQlFUYDEZIGBMRVsaqHwctXXf7WEYB4Ag1xjihkMZsiUkKhIAIfkECQoAAAAsAAAAABAAEAAAAzYIujIjK8pByJDMlFYvBoVjHA70GU7xSUJhmKtwHPAKzLO9HMaoKwJZ7Rf8AYPDDzKpZBqfvwQAIfkECQoAAAAsAAAAABAAEAAAAzMIumIlK8oyhpHsnFZfhYumCYUhDAQxRIdhHBGqRoKw0R8DYlJd8z0fMDgsGo/IpHI5TAAAIfkECQoAAAAsAAAAABAAEAAAAzIIunInK0rnZBTwGPNMgQwmdsNgXGJUlIWEuR5oWUIpz8pAEAMe6TwfwyYsGo/IpFKSAAAh+QQJCgAAACwAAAAAEAAQAAADMwi6IMKQORfjdOe82p4wGccc4CEuQradylesojEMBgsUc2G7sDX3lQGBMLAJibufbSlKAAAh+QQJCgAAACwAAAAAEAAQAAADMgi63P7wCRHZnFVdmgHu2nFwlWCI3WGc3TSWhUFGxTAUkGCbtgENBMJAEJsxgMLWzpEAACH5BAkKAAAALAAAAAAQABAAAAMyCLrc/jDKSatlQtScKdceCAjDII7HcQ4EMTCpyrCuUBjCYRgHVtqlAiB1YhiCnlsRkAAAOwAAAAAAAAAAAA=="> <a href="#/login" class="btn btn-link">Cancel</a> </div> </form> </div>')}]);